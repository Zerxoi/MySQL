# 10 数据库设计三范式

## 设计范式

设计表的依据

按照三范式设计的表不会出现数据冗余

第一范式：任何一张表都应该有主键， 并且每一个字段原子性不可再分。

|学生编号|学生姓名|联系方式|
|-------|-------|--------|
|1001|张三|zs@gmail.com, 13533333333|
|1002|李四|ls@qq.com, 13644444444|
|1003|王五|ww@163.com, 13855555555|

上表没有主键， 并且联系方式可以再分， 分为 Email 和 联系电话。

|学生编号（pk）|学生姓名|Email|联系电话|
|-------|-------|-----|--------|
|1001|张三|zs@gmail.com|13533333333|
|1002|李四|ls@qq.com|13644444444|
|1003|王五|ww@163.com|13855555555|


第二范式： 建立在第一范式的基础之上， 所有非主键字段完全依赖主键， 不能产生部分依赖。
多对多： 3张表，关系表2个外键

|学生编号|学生姓名|教师编号|教师姓名|
|-------|-------|-------|--------|
|1001|张三|001|王老师|
|1002|李四|002|赵老师|
|1003|王五|001|王老师|
|1001|张三|002|赵老师|

该表没有主键， 可以看出主键是 学生编号 和 教师编号 的联合

|学生编号（pk）|教师编号（pk）|学生姓名|教师姓名|
|-------|-------|-------|--------|
|1001|001|张三|王老师|
|1002|002|李四|赵老师|
|1003|001|王五|王老师|
|1001|002|张三|赵老师|

可以看出学生姓名字段对主键中的学生编号有部分依赖， 教师姓名对主键中的教师编号有部分依赖

**学生表**
|学生编号（pk）|学生姓名|
|-------|-------|
|1001|张三|
|1002|李四|
|1003|王五|

**教师表**
|教师编号（pk）|教师姓名|
|-------|-------|
|001|王老师|
|002|赵老师|

**关系表**
|学生编号（fk 学生表.学生编号）|教师编号（fk 教师表.教师编号）|
|------|------|
|1001|001|
|1002|002|
|1003|001|
|1001|002|

第三范式： 建立在第二范式的基础之上， 所有非主键字段直接依赖主键， 不能产生传递依赖。
一对多： 两张表，多的表加外键

|学生编号（pk）|学生姓名|班级编号|班级名称|
|-------------|-------|-------|--------|
|1001|张三|01|一年一班|
|1002|李四|02|一年二班|
|1003|王五|03|一年三班|
|1004|赵六|03|一年三班|

该表满足第一范式， 有主键， 字段不可再分； 因为是单一主键， 因此不会有部分依赖所以满足第二范式。


从上表可以看出， 班级名称字段存在冗余， 因为班级名称没有直接依赖于主键， 班级名称字段依赖于班级编号， 班级编号依赖于学生编号， 因此班级名称传递依赖于学生编号， 不满足第三范式。

解决犯办法是将冗余字段单独拿出来建立表。

**学生信息表**
|学生编号（pk）|学生姓名|班级编号（fk 班级信息表.班级编号）|
|-------------|-------|-------|
|1001|张三|01|
|1002|李四|02|
|1003|王五|03|
|1004|赵六|03|

**班级信息表**
|班级编（pk）号|班级名称|
|-------|-------|
|01|一年一班|
|02|一年二班|
|03|一年三班|

总结： 在实际开发中， 以客户需求为主， 有的时候会用数据冗余换取执行速度。（因为表的连接执行效率很低）

## 一对一的设计

t_user 用户表（id（pk）， 用户名， 密码， 性别， 电话， 家庭住址， ...）

方案一：主键共享
t_user_login 用户登录表（id（pk）， 用户名， 密码）
t_user_detail 用户详细信息表（id（pk+fk（t_user_login.id））， 性别， 电话， 家庭住址， ...）

方案二： 外键唯一（一对多的变形，加了unique唯一约束）
t_user_login 用户登录表（id（pk）， 用户名， 密码）
t_user_detail 用户详细信息表（id（pk）， 性别， 电话， 家庭住址， ...， userid（fk(t_user_login.id)+unique））